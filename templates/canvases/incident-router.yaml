metadata:
  name: "Incident Router"
  description: "Route P1 incidents from Slack mentions to PagerDuty and GitHub with AI-generated titles and descriptions."
  isTemplate: false
spec:
  nodes:
    - id: "slack-onappmention-slack-onappmention-knb9lx"
      name: "Listen to mentions of the Slack Bot"
      type: "TYPE_TRIGGER"
      configuration:
        channel: "C09AJT3BF1Q"
      metadata: null
      position:
        x: 319
        "y": 501
      component: null
      blueprint: null
      trigger:
        name: "slack.onAppMention"
      widget: null
      isCollapsed: false
      integration: null
      errorMessage: "integration is required"
      warningMessage: ""
    - id: "component-node-micxb6"
      name: "filter"
      type: "TYPE_COMPONENT"
      configuration:
        expression: "indexOf(\n  lower(\n    toJSON(root().data.blocks ?? [])\n    + \" \"\n    + (root().data.issue?.body ?? \"\")\n    + \" \"\n    + (root().data.issue?.title ?? \"\")\n    + \" \"\n    + (root().data.comment?.body ?? \"\")\n  ),\n  \"p1 issue\"\n) >= 0\n"
      metadata: null
      position:
        x: 893
        "y": 500
      component:
        name: "filter"
      blueprint: null
      trigger: null
      widget: null
      isCollapsed: false
      integration: null
      errorMessage: ""
      warningMessage: ""
    - id: "component-node-683h8w"
      name: "Generate issue title"
      type: "TYPE_COMPONENT"
      configuration:
        input: "You are generating a PagerDuty incident TITLE based on a Slack message.\n\nInput:\n- A single Slack message text mentioned to a bot.\n\nYour task:\n- Read the Slack message.\n- Extract the core problem or symptom.\n- Generate a short, clear incident title suitable for PagerDuty.\n\nHard rules:\n- Output a single line of plain text.\n- NO markdown, NO emojis, NO quotes.\n- NO trailing punctuation.\n- Title length: 5 to 12 words.\n- Use present tense.\n- Be specific, not generic.\n- Do not include usernames, channel names, timestamps, or Slack formatting.\n- Do not include severity labels unless explicitly mentioned in the message.\n- Do not add explanations or context.\n\nIf the message is unclear or too generic:\n- Produce a neutral title describing the symptom.\n- Do not invent details.\n\nInput Slack message:\n{{ root().data }}\n"
        model: "gpt-5.2"
      metadata: null
      position:
        x: 1427
        "y": 500
      component:
        name: "openai.textPrompt"
      blueprint: null
      trigger: null
      widget: null
      isCollapsed: false
      integration: null
      errorMessage: ""
      warningMessage: ""
    - id: "component-node-hw4ezb"
      name: "Generate issue description"
      type: "TYPE_COMPONENT"
      configuration:
        input: "You are generating a PagerDuty incident DESCRIPTION based on a Slack message.\n\nInput:\n- A single Slack message text mentioned to a bot.\n\nYour task:\n- Rewrite the Slack message into a clear incident description.\n- Preserve the original meaning and important details.\n- Expand abbreviations only if they are obvious from context.\n\nHard rules:\n- Output plain text only (no Markdown, no emojis).\n- Use real line breaks (press Enter) for readability.\n- Keep it short and structured (3 to 6 lines max).\n- Do not invent causes, impact, or remediation.\n- Do not suggest next steps or actions.\n- Do not include Slack-specific elements (usernames, channel names, message IDs, reactions).\n- Do not add a title or summary line.\n\nContent guidelines:\n- Line 1: What is happening (symptom or alert).\n- Line 2: Affected service or component (if mentioned).\n- Line 3: When it started or was observed (if mentioned).\n- Optional additional lines only if the message clearly contains that info.\n\nIf the message is vague:\n- Restate the problem as clearly as possible using the available words.\n- Do not guess.\n\nInput Slack message:\n{{ root().data.text }}\n"
        model: "gpt-5.2"
      metadata: null
      position:
        x: 1421
        "y": 663
      component:
        name: "openai.textPrompt"
      blueprint: null
      trigger: null
      widget: null
      isCollapsed: false
      integration: null
      errorMessage: ""
      warningMessage: ""
    - id: "component-node-rcby5g"
      name: "Create PD incident"
      type: "TYPE_COMPONENT"
      configuration:
        description: "{{ $[\"Generate issue description\"].data.text }}"
        service: "PQEAM2I"
        title: "{{ $[\"Generate issue title\"].data.text}}"
        urgency: "high"
      metadata:
        service:
          html_url: "https://superplane-test.eu.pagerduty.com/service-directory/PQEAM2I"
          id: "PQEAM2I"
          name: "Default Service"
      position:
        x: 2487
        "y": 425
      component:
        name: "pagerduty.createIncident"
      blueprint: null
      trigger: null
      widget: null
      isCollapsed: true
      integration: null
      errorMessage: ""
      warningMessage: ""
    - id: "component-node-c9hql3"
      name: "Create issue on GitHub"
      type: "TYPE_COMPONENT"
      configuration:
        body: "Description:\n{{$['Generate issue description'].data.text}}\n\n- [ ] Resolve the incident\n- [ ] Root cause investigation\n- [ ] Corrective Action scheduled and logged\n- [ ] Create and attach postmortem report "
        repository: "puppy-describer"
        title: "Incident: {{ $[\"Generate issue title\"].data.text }}"
      metadata:
        repository:
          id: 1046188046
          name: "puppy-describer"
          url: "https://github.com/puppies-inc/puppy-describer"
      position:
        x: 2487
        "y": 534
      component:
        name: "github.createIssue"
      blueprint: null
      trigger: null
      widget: null
      isCollapsed: true
      integration: null
      errorMessage: ""
      warningMessage: ""
    - id: "annotation-annotation2-88tc68"
      name: "annotation2"
      type: "TYPE_WIDGET"
      configuration:
        color: "yellow"
        height: 236
        text: "### 2. Filter which events to forward\n\nThe Filter component subscribes to events from external resources and forwards only those that contain \"P1 issue\" in their text.\n\n___\nSuperPlane is an event-driven workflow engine that supports expressive, flexible conditions.\n\n- Click the Filter node to see how expressions are defined\n- Explore the [Data Flow](https://docs.superplane.com/concepts/data-flow/) documentation for more details\n"
        width: 436
      metadata: null
      position:
        x: 863
        "y": 179
      component: null
      blueprint: null
      trigger: null
      widget:
        name: "annotation"
      isCollapsed: false
      integration: null
      errorMessage: ""
      warningMessage: ""
    - id: "annotation-annotation3-q7feag"
      name: "annotation3"
      type: "TYPE_WIDGET"
      configuration:
        color: "yellow"
        height: 168
        text: "### 3. Use AI to generate a title and description\n\nThe OpenAI component can access payloads from upstream nodes. Here, it generates a title and description used to create a PagerDuty incident and a GitHub issue. A Merge component waits for both outputs before continuing.\n\n___\n- See how the OpenAI component references upstream data\n- Explore how the [Merge component](https://docs.superplane.com/components/core/#merge) works\n"
        width: 759
      metadata: null
      position:
        x: 1445
        "y": 179
      component: null
      blueprint: null
      trigger: null
      widget:
        name: "annotation"
      isCollapsed: false
      integration: null
      errorMessage: ""
      warningMessage: ""
    - id: "annotation-annotation4-l5nxvh"
      name: "annotation4"
      type: "TYPE_WIDGET"
      configuration:
        color: "yellow"
        height: 208
        text: "### 4. Send notifications via PagerDuty, GitHub, and Slack\n\nUse the AI-generated summary to open an incident in PagerDuty and create a GitHub issue with a predefined requirements checklist. The resulting links are then shared via Slack for visibility and coordination.\n\n___\n- Explore the PagerDuty and GitHub components to see how incidents and issues are created\n- Review how event data emitted by these components is used downstream\n- Check how the Slack component combines this data to post a message with links to the incident and issue\n"
        width: 841
      metadata: null
      position:
        x: 2471
        "y": 174
      component: null
      blueprint: null
      trigger: null
      widget:
        name: "annotation"
      isCollapsed: false
      integration: null
      errorMessage: ""
      warningMessage: ""
    - id: "github-onissuecomment-github-onissuecomment-fyflwt"
      name: "Listen to issue Comments"
      type: "TYPE_TRIGGER"
      configuration:
        repository: "terraform"
      metadata:
        repository:
          id: 1046227550
          name: "terraform"
          url: "https://github.com/puppies-inc/terraform"
      position:
        x: 322
        "y": 886
      component: null
      blueprint: null
      trigger:
        name: "github.onIssueComment"
      widget: null
      isCollapsed: false
      integration: null
      errorMessage: ""
      warningMessage: ""
    - id: "merge-merge-jjlkwm"
      name: "Wait for both Title and Description"
      type: "TYPE_COMPONENT"
      configuration:
        enableStopIf: false
        enableTimeout: true
        executionTimeout:
          unit: "minutes"
          value: 2
      metadata: null
      position:
        x: 1922
        "y": 500
      component:
        name: "merge"
      blueprint: null
      trigger: null
      widget: null
      isCollapsed: true
      integration: null
      errorMessage: ""
      warningMessage: ""
    - id: "component-node-doptqx"
      name: "Send Slack Notification"
      type: "TYPE_COMPONENT"
      configuration:
        text: "New P1 incident!\n\nLink to the incident: {{$['Create PD incident'].data.incident.html_url}}\n\nLink to the issue: {{$['Create issue on GitHub'].data.url}}"
      metadata: null
      position:
        x: 3011
        "y": 464
      component:
        name: "slack.sendTextMessage"
      blueprint: null
      trigger: null
      widget: null
      isCollapsed: true
      integration: null
      errorMessage: "field 'channel' is required"
      warningMessage: ""
    - id: "github-onissue-github-onissue-aq6dfc"
      name: "Listen to new Issues"
      type: "TYPE_TRIGGER"
      configuration:
        actions:
          - "opened"
        repository: "terraform"
      metadata:
        repository:
          id: 1046227550
          name: "terraform"
          url: "https://github.com/puppies-inc/terraform"
      position:
        x: 319
        "y": 677
      component: null
      blueprint: null
      trigger:
        name: "github.onIssue"
      widget: null
      isCollapsed: false
      integration: null
      errorMessage: ""
      warningMessage: ""
    - id: "annotation-annotation5-601278"
      name: "annotation5"
      type: "TYPE_WIDGET"
      configuration:
        color: "yellow"
        height: 251
        text: "### 1. Listen to external resources\n\nTrigger components listen for events from external systems, such as new GitHub issues, issue comments, or mentions of the SuperPlane Slack app.\n\n___\nTo use this example, connect your GitHub and Slack accounts:\n\n- Click each node\n- Follow the connection instructions for GitHub and Slack\n- Configure the required settings (GitHub repository, Slack channel)\n"
        width: 491
      metadata: null
      position:
        x: 246
        "y": 175
      component: null
      blueprint: null
      trigger: null
      widget:
        name: "annotation"
      isCollapsed: false
      integration: null
      errorMessage: ""
      warningMessage: ""
  edges:
    - sourceId: "slack-onappmention-slack-onappmention-knb9lx"
      targetId: "component-node-micxb6"
      channel: "default"
    - sourceId: "component-node-micxb6"
      targetId: "component-node-683h8w"
      channel: "default"
    - sourceId: "github-onissuecomment-github-onissuecomment-fyflwt"
      targetId: "component-node-micxb6"
      channel: "default"
    - sourceId: "component-node-683h8w"
      targetId: "merge-merge-jjlkwm"
      channel: "default"
    - sourceId: "component-node-hw4ezb"
      targetId: "merge-merge-jjlkwm"
      channel: "default"
    - sourceId: "merge-merge-jjlkwm"
      targetId: "component-node-rcby5g"
      channel: "success"
    - sourceId: "merge-merge-jjlkwm"
      targetId: "component-node-c9hql3"
      channel: "success"
    - sourceId: "component-node-rcby5g"
      targetId: "component-node-doptqx"
      channel: "default"
    - sourceId: "component-node-c9hql3"
      targetId: "component-node-doptqx"
      channel: "default"
    - sourceId: "component-node-micxb6"
      targetId: "component-node-hw4ezb"
      channel: "default"
    - sourceId: "github-onissue-github-onissue-aq6dfc"
      targetId: "component-node-micxb6"
      channel: "default"
