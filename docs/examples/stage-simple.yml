piVersion: v1
kind: Stage
metadata:
  name: stage-1
  canvasId: a88894a7-8043-4e55-a9f1-e2ca85887a42
spec:
  connections:
    - type: TYPE_EVENT_SOURCE
      name: docs
    - type: TYPE_EVENT_SOURCE
      name: terraform

  inputs:
    - name: DOCS_VERSION
      description: ""
    - name: TERRAFORM_VERSION
      description: ""

  inputMappings:
    - when:
        triggeredBy:
          connection: docs
      values:
        - name: DOCS_VERSION
          valueFrom:
            eventData:
              connection: docs
              expression: ref
        - name: TERRAFORM_VERSION
          valueFrom:
            lastExecution:
              result: [RESULT_PASSED]

    - when:
        triggeredBy:
          connection: terraform
      values:
        - name: DOCS_VERSION
          valueFrom:
            lastExecution:
              result: [RESULT_FAILED, RESULT_PASSED]

        - name: TERRAFORM_VERSION
          valueFrom:
            eventData:
              connection: terraform
              expression: ref

  executor:
    type: TYPE_SEMAPHORE
    semaphore:
      organizationUrl: https://lucaspin.sxmoon.com
      apiToken: XXXX
      projectId: dfafcfe4-cf55-4cb9-abde-c073733c9b83
      taskId: fd67cfb1-e06c-4896-a517-c648f878330a
      branch: sxmoon
      pipelineFile: .semaphore/pipeline_3.yml
      parameters:
        - name: DOCS_VERSION
          value: ${{ inputs.DOCS_VERSION }}
        - name: TERRAFORM_VERSION
          value: ${{ inputs.TERRAFORM_VERSION }}
